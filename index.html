<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Tracker - Select User</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #4cc9f0;
            --success: #4ade80;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --card-bg: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

        /* User Selection Screen */
        .user-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
            text-align: center;
        }

        .user-selection h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--secondary);
        }

        .user-selection p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: var(--gray);
            max-width: 600px;
        }

        .user-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 900px;
            margin-bottom: 30px;
        }

        .user-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .user-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .user-card.active {
            border: 3px solid var(--primary);
        }

        .user-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 2rem;
            margin-bottom: 15px;
            color: white;
        }

        .user-card h3 {
            margin-bottom: 5px;
            color: var(--secondary);
        }

        .user-card p {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .user-stats {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 10px;
        }

        .user-stat {
            text-align: center;
        }

        .user-stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .user-stat-label {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--primary);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            text-decoration: none;
        }

        .btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-large {
            padding: 15px 30px;
            font-size: 1.1rem;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        /* Main App (hidden initially) */
        #main-app {
            display: none;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 0;
            box-shadow: var(--shadow);
            border-radius: 0 0 12px 12px;
            margin-bottom: 20px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo i {
            font-size: 2rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        nav ul li a:hover, nav ul li a.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .main-content {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
        }

        .sidebar {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .sidebar-section {
            margin-bottom: 25px;
        }

        .sidebar-section h3 {
            margin-bottom: 15px;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-card {
            background: var(--light);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .progress-bar {
            height: 8px;
            background-color: #e2e8f0;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--primary));
            border-radius: 4px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .card h3 {
            margin-bottom: 15px;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-container {
            height: 250px;
            margin-top: 15px;
        }

        .workout-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .workout-item {
            background: var(--light);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .workout-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .workout-info h4 {
            margin-bottom: 5px;
            color: var(--secondary);
        }

        .workout-meta {
            font-size: 0.9rem;
            color: var(--gray);
            display: flex;
            gap: 15px;
        }

        .workout-actions {
            display: flex;
            gap: 10px;
        }

        .workout-actions button {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .tab-container {
            background: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .tabs {
            display: flex;
            background: var(--light);
            border-bottom: 1px solid #e2e8f0;
        }

        .tab {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab.active {
            background: var(--card-bg);
            border-bottom: 3px solid var(--primary);
            font-weight: 600;
            color: var(--primary);
        }

        .tab-content {
            padding: 20px;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark);
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .goal-item {
            background: var(--light);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .goal-title {
            font-weight: 600;
            color: var(--secondary);
        }

        .goal-deadline {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .user-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .user-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border-radius: 8px;
            background: var(--light);
            cursor: pointer;
            transition: all 0.3s;
        }

        .user-item:hover {
            background: #e2e8f0;
        }

        .user-item.active {
            background: var(--primary);
            color: white;
        }

        .user-item-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar-small {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--gray);
            border-top: 1px solid #cbd5e1;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .workout-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .workout-actions {
                align-self: flex-end;
            }
            
            .user-cards {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
                width: 100%;
                max-width: 300px;
            }
            
            .action-buttons .btn {
                width: 100%;
            }
        }

        .achievement-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: var(--light);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1100;
            transform: translateX(150%);
            transition: transform 0.3s;
        }

        .notification.show {
            transform: translateX(0);
        }

        .user-management {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .user-switcher {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .new-user-form {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-top: 30px;
            max-width: 600px;
            width: 100%;
        }
        
        .nutrition-summary {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }
        
        .measurement-item {
            background: var(--light);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .measurement-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .empty-state {
            text-align: center;
            padding: 30px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #cbd5e1;
        }
    </style>
</head>
<body>
    <!-- User Selection Screen -->
    <div class="container" id="user-selection">
        <div class="user-selection">
            <h1><i class="fas fa-dumbbell"></i> Fitness Tracker</h1>
            <p>Select a user profile to start tracking your fitness journey</p>
            
            <div class="user-cards" id="userCards">
                <!-- User cards will be dynamically added here -->
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-large" id="startAppBtn" disabled>
                    <i class="fas fa-play"></i> Start Fitness Tracker
                </button>
                <button class="btn btn-outline btn-large" id="addUserBtn">
                    <i class="fas fa-user-plus"></i> Add New User
                </button>
            </div>
            
            <div class="new-user-form" id="newUserForm" style="display: none;">
                <h2>Create New User Profile</h2>
                <form id="userForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="userName">Full Name</label>
                            <input type="text" id="userName" required>
                        </div>
                        <div class="form-group">
                            <label for="userEmail">Email</label>
                            <input type="email" id="userEmail" required>
                        </div>
                        <div class="form-group">
                            <label for="userAge">Age</label>
                            <input type="number" id="userAge" min="1" max="120" required>
                        </div>
                        <div class="form-group">
                            <label for="userGender">Gender</label>
                            <select id="userGender" required>
                                <option value="">Select</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="userHeight">Height (cm)</label>
                            <input type="number" id="userHeight" min="1" required>
                        </div>
                        <div class="form-group">
                            <label for="userWeight">Weight (kg)</label>
                            <input type="number" id="userWeight" step="0.1" required>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Create Profile
                        </button>
                        <button type="button" class="btn btn-outline" id="cancelAddUserBtn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Application (hidden initially) -->
    <div id="main-app">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <i class="fas fa-dumbbell"></i>
                        <span>FitPro Multi-User</span>
                    </div>
                    <nav>
                        <ul>
                            <li><a href="#" class="active" data-tab="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                            <li><a href="#" data-tab="workouts"><i class="fas fa-running"></i> Workouts</a></li>
                            <li><a href="#" data-tab="nutrition"><i class="fas fa-apple-alt"></i> Nutrition</a></li>
                            <li><a href="#" data-tab="progress"><i class="fas fa-chart-line"></i> Progress</a></li>
                            <li><a href="#" data-tab="goals"><i class="fas fa-bullseye"></i> Goals</a></li>
                            <li><a href="#" data-tab="users"><i class="fas fa-users"></i> Users</a></li>
                        </ul>
                    </nav>
                    <div class="user-info">
                        <div class="user-avatar" id="currentUserAvatar">JD</div>
                        <span id="currentUserName">John Doe</span>
                    </div>
                </div>
            </div>
        </header>

        <div class="container">
            <div class="user-management">
                <div class="user-switcher">
                    <span>Active User:</span>
                    <div class="user-avatar" id="activeUserAvatar">JD</div>
                    <span id="activeUserName">John Doe</span>
                </div>
                <button class="btn btn-outline" id="switchUserBtn"><i class="fas fa-exchange-alt"></i> Switch User</button>
                <button class="btn btn-outline" id="backToSelectionBtn"><i class="fas fa-arrow-left"></i> Back to Selection</button>
            </div>

            <div class="main-content">
                <aside class="sidebar">
                    <div class="sidebar-section">
                        <h3><i class="fas fa-fire"></i> Today's Summary</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="todayCalories">0</div>
                                <div class="stat-label">Calories</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="todayMinutes">0</div>
                                <div class="stat-label">Minutes</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="todayWorkouts">0</div>
                                <div class="stat-label">Workouts</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="todaySteps">0</div>
                                <div class="stat-label">Steps</div>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3><i class="fas fa-trophy"></i> Achievements</h3>
                        <div id="achievementsList">
                            <!-- Achievements will be dynamically added here -->
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3><i class="fas fa-bullseye"></i> Goal Progress</h3>
                        <div class="goal-progress" id="goalProgressList">
                            <!-- Goals will be dynamically added here -->
                        </div>
                    </div>

                    <button class="btn" id="quickWorkoutBtn"><i class="fas fa-plus"></i> Quick Workout</button>
                    <button class="btn btn-success" id="addMealBtn"><i class="fas fa-utensils"></i> Log Meal</button>
                </aside>

                <main>
                    <div class="tab-container">
                        <div class="tabs">
                            <div class="tab active" data-tab="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</div>
                            <div class="tab" data-tab="workouts"><i class="fas fa-running"></i> Workouts</div>
                            <div class="tab" data-tab="nutrition"><i class="fas fa-apple-alt"></i> Nutrition</div>
                            <div class="tab" data-tab="progress"><i class="fas fa-chart-line"></i> Progress</div>
                            <div class="tab" data-tab="goals"><i class="fas fa-bullseye"></i> Goals</div>
                            <div class="tab" data-tab="users"><i class="fas fa-users"></i> Users</div>
                        </div>

                        <!-- Dashboard Tab -->
                        <div class="tab-content active" id="dashboard">
                            <div class="dashboard">
                                <div class="card">
                                    <h3><i class="fas fa-chart-bar"></i> Weekly Activity</h3>
                                    <div class="chart-container">
                                        <canvas id="activityChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="card">
                                    <h3><i class="fas fa-weight"></i> Weight Progress</h3>
                                    <div class="chart-container">
                                        <canvas id="weightChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="card">
                                    <h3><i class="fas fa-heartbeat"></i> Health Stats</h3>
                                    <div class="stats-grid" style="grid-template-columns: 1fr;">
                                        <div class="stat-card">
                                            <div class="stat-value" id="restingHR">--</div>
                                            <div class="stat-label">Resting HR (bpm)</div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-value" id="avgSleep">--</div>
                                            <div class="stat-label">Avg Sleep (hrs)</div>
                                        </div>
                                        <div class="stat-card">
                                            <div class="stat-value" id="avgCalories">--</div>
                                            <div class="stat-label">Avg Calories</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card">
                                    <h3><i class="fas fa-history"></i> Recent Activity</h3>
                                    <div class="workout-list" id="recentWorkouts">
                                        <!-- Recent workouts will be dynamically added here -->
                                    </div>
                                    <button class="btn" style="margin-top: 15px;" id="viewAllActivityBtn">View All Activity</button>
                                </div>
                            </div>
                        </div>

                        <!-- Workouts Tab -->
                        <div class="tab-content" id="workouts">
                            <div class="card">
                                <h3><i class="fas fa-dumbbell"></i> Log New Workout</h3>
                                <form id="workoutForm">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="workoutType">Workout Type</label>
                                            <select id="workoutType" required>
                                                <option value="">Select a type</option>
                                                <option value="cardio">Cardio</option>
                                                <option value="strength">Strength Training</option>
                                                <option value="yoga">Yoga/Pilates</option>
                                                <option value="sports">Sports</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="workoutDate">Date</label>
                                            <input type="date" id="workoutDate" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="workoutDuration">Duration (minutes)</label>
                                            <input type="number" id="workoutDuration" min="1" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="workoutCalories">Calories Burned</label>
                                            <input type="number" id="workoutCalories" min="1" required>
                                        </div>
                                        <div class="form-group" style="grid-column: 1 / -1;">
                                            <label for="workoutNotes">Notes</label>
                                            <textarea id="workoutNotes" rows="3"></textarea>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Save Workout</button>
                                </form>
                            </div>
                            
                            <div class="card">
                                <h3><i class="fas fa-history"></i> Workout History</h3>
                                <div class="workout-list" id="workoutHistory">
                                    <!-- Workout items will be dynamically added here -->
                                </div>
                            </div>
                        </div>

                        <!-- Nutrition Tab -->
                        <div class="tab-content" id="nutrition">
                            <div class="card">
                                <h3><i class="fas fa-utensils"></i> Today's Nutrition</h3>
                                <div class="chart-container">
                                    <canvas id="nutritionChart"></canvas>
                                </div>
                                <div class="nutrition-summary">
                                    <div class="stat-card">
                                        <div class="stat-value" id="totalCalories">0</div>
                                        <div class="stat-label">Calories</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-value" id="totalProtein">0g</div>
                                        <div class="stat-label">Protein</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-value" id="totalCarbs">0g</div>
                                        <div class="stat-label">Carbs</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="stat-value" id="totalFat">0g</div>
                                        <div class="stat-label">Fat</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <h3><i class="fas fa-plus-circle"></i> Log Meal</h3>
                                <form id="mealForm">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="mealName">Meal Name</label>
                                            <input type="text" id="mealName" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="mealType">Meal Type</label>
                                            <select id="mealType" required>
                                                <option value="">Select type</option>
                                                <option value="breakfast">Breakfast</option>
                                                <option value="lunch">Lunch</option>
                                                <option value="dinner">Dinner</option>
                                                <option value="snack">Snack</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="mealCalories">Calories</label>
                                            <input type="number" id="mealCalories" min="1" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="mealProtein">Protein (g)</label>
                                            <input type="number" id="mealProtein" min="0" step="0.1">
                                        </div>
                                        <div class="form-group">
                                            <label for="mealCarbs">Carbs (g)</label>
                                            <input type="number" id="mealCarbs" min="0" step="0.1">
                                        </div>
                                        <div class="form-group">
                                            <label for="mealFat">Fat (g)</label>
                                            <input type="number" id="mealFat" min="0" step="0.1">
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Log Meal</button>
                                </form>
                            </div>
                        </div>

                        <!-- Progress Tab -->
                        <div class="tab-content" id="progress">
                            <div class="card">
                                <h3><i class="fas fa-chart-line"></i> Body Measurements</h3>
                                <div class="chart-container">
                                    <canvas id="measurementsChart"></canvas>
                                </div>
                            </div>
                            
                            <div class="card">
                                <h3><i class="fas fa-weight"></i> Track New Measurement</h3>
                                <form id="measurementForm">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="measurementType">Measurement Type</label>
                                            <select id="measurementType" required>
                                                <option value="weight">Weight</option>
                                                <option value="chest">Chest</option>
                                                <option value="waist">Waist</option>
                                                <option value="hips">Hips</option>
                                                <option value="biceps">Biceps</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="measurementValue">Value</label>
                                            <input type="number" id="measurementValue" step="0.1" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="measurementDate">Date</label>
                                            <input type="date" id="measurementDate" required>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Save Measurement</button>
                                </form>
                            </div>
                            
                            <div class="card">
                                <h3><i class="fas fa-ruler"></i> Measurement History</h3>
                                <div id="measurementHistory">
                                    <!-- Measurements will be dynamically added here -->
                                </div>
                            </div>
                        </div>

                        <!-- Goals Tab -->
                        <div class="tab-content" id="goals">
                            <div class="card">
                                <h3><i class="fas fa-bullseye"></i> Set New Goal</h3>
                                <form id="goalForm">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="goalType">Goal Type</label>
                                            <select id="goalType" required>
                                                <option value="">Select type</option>
                                                <option value="weight">Weight Loss/Gain</option>
                                                <option value="workout">Workout Frequency</option>
                                                <option value="distance">Running Distance</option>
                                                <option value="strength">Strength Improvement</option>
                                                <option value="nutrition">Nutrition</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="goalTarget">Target</label>
                                            <input type="text" id="goalTarget" placeholder="e.g., 160 lbs, 5 days/week" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="goalDeadline">Deadline</label>
                                            <input type="date" id="goalDeadline" required>
                                        </div>
                                        <div class="form-group" style="grid-column: 1 / -1;">
                                            <label for="goalDescription">Description</label>
                                            <textarea id="goalDescription" rows="3"></textarea>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Set Goal</button>
                                </form>
                            </div>
                            
                            <div class="card">
                                <h3><i class="fas fa-list-check"></i> Current Goals</h3>
                                <div id="goalsList">
                                    <!-- Goals will be dynamically added here -->
                                </div>
                            </div>
                        </div>

                        <!-- Users Tab -->
                        <div class="tab-content" id="users">
                            <div class="card">
                                <h3><i class="fas fa-user-plus"></i> Add New User</h3>
                                <form id="userFormMain">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label for="userNameMain">Full Name</label>
                                            <input type="text" id="userNameMain" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="userEmailMain">Email</label>
                                            <input type="email" id="userEmailMain" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="userAgeMain">Age</label>
                                            <input type="number" id="userAgeMain" min="1" max="120" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="userGenderMain">Gender</label>
                                            <select id="userGenderMain" required>
                                                <option value="">Select</option>
                                                <option value="male">Male</option>
                                                <option value="female">Female</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="userHeightMain">Height (cm)</label>
                                            <input type="number" id="userHeightMain" min="1" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="userWeightMain">Weight (kg)</label>
                                            <input type="number" id="userWeightMain" step="0.1" required>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Add User</button>
                                </form>
                            </div>
                            
                            <div class="card">
                                <h3><i class="fas fa-users"></i> All Users</h3>
                                <div class="user-list" id="usersList">
                                    <!-- Users will be dynamically added here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- Switch User Modal -->
    <div class="modal" id="switchUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Switch User</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="user-list" id="switchUserList">
                <!-- Users will be dynamically added here -->
            </div>
        </div>
    </div>

    <!-- Quick Workout Modal -->
    <div class="modal" id="quickWorkoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Quick Workout</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="quickWorkoutForm">
                <div class="form-group">
                    <label for="quickWorkoutType">Workout Type</label>
                    <select id="quickWorkoutType" required>
                        <option value="walk">Walk</option>
                        <option value="run">Run</option>
                        <option value="cycle">Cycle</option>
                        <option value="yoga">Yoga</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="quickWorkoutDuration">Duration (minutes)</label>
                    <input type="number" id="quickWorkoutDuration" min="5" max="120" value="30" required>
                </div>
                <button type="submit" class="btn"><i class="fas fa-play"></i> Start Workout</button>
            </form>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationText">Operation completed successfully!</span>
    </div>

    <footer>
        <div class="container">
            <p>Multi-User Fitness Tracker &copy; 2023 | Track Your Progress, Transform Your Life</p>
        </div>
    </footer>

    <script>
        // Multi-User Fitness Tracker
        const MultiUserFitnessTracker = {
            // Initialize the app
            init() {
                this.setupEventListeners();
                this.loadData();
                this.displayUserSelection();
            },
            
            // Setup all event listeners
            setupEventListeners() {
                // User selection screen
                document.getElementById('startAppBtn').addEventListener('click', () => this.startApp());
                document.getElementById('addUserBtn').addEventListener('click', () => this.showNewUserForm());
                document.getElementById('cancelAddUserBtn').addEventListener('click', () => this.hideNewUserForm());
                document.getElementById('userForm').addEventListener('submit', (e) => this.handleUserSubmit(e));
                
                // Main app event listeners (set up after app starts)
            },
            
            // Load initial data
            loadData() {
                // Check if we have existing data, if not initialize with empty arrays
                if (!localStorage.getItem('fitnessTrackerUsers')) {
                    localStorage.setItem('fitnessTrackerUsers', JSON.stringify([]));
                }
                
                if (!localStorage.getItem('fitnessTrackerWorkouts')) {
                    localStorage.setItem('fitnessTrackerWorkouts', JSON.stringify([]));
                }
                
                if (!localStorage.getItem('fitnessTrackerGoals')) {
                    localStorage.setItem('fitnessTrackerGoals', JSON.stringify([]));
                }
                
                if (!localStorage.getItem('fitnessTrackerMeasurements')) {
                    localStorage.setItem('fitnessTrackerMeasurements', JSON.stringify([]));
                }
                
                if (!localStorage.getItem('fitnessTrackerNutrition')) {
                    localStorage.setItem('fitnessTrackerNutrition', JSON.stringify([]));
                }
            },
            
            // Display user selection screen
            displayUserSelection() {
                const users = this.getUsers();
                const userCards = document.getElementById('userCards');
                const startAppBtn = document.getElementById('startAppBtn');
                
                if (users.length === 0) {
                    userCards.innerHTML = `
                        <div class="user-card" style="grid-column: 1 / -1; text-align: center;">
                            <div class="user-avatar-large" style="background: var(--gray);">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <h3>No Users Found</h3>
                            <p>Create your first user profile to get started with the fitness tracker</p>
                        </div>
                    `;
                    startAppBtn.disabled = true;
                    return;
                }
                
                userCards.innerHTML = users.map(user => `
                    <div class="user-card" data-user-id="${user.id}">
                        <div class="user-avatar-large" style="background: ${this.getUserColor(user.id)};">
                            ${this.getInitials(user.name)}
                        </div>
                        <h3>${user.name}</h3>
                        <p>${user.age} years • ${user.gender}</p>
                        <div class="user-stats">
                            <div class="user-stat">
                                <div class="user-stat-value">${this.getUserWorkoutCount(user.id)}</div>
                                <div class="user-stat-label">Workouts</div>
                            </div>
                            <div class="user-stat">
                                <div class="user-stat-value">${this.getUserGoalCount(user.id)}</div>
                                <div class="user-stat-label">Goals</div>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                // Add click event to user cards
                document.querySelectorAll('.user-card').forEach(card => {
                    card.addEventListener('click', () => {
                        document.querySelectorAll('.user-card').forEach(c => c.classList.remove('active'));
                        card.classList.add('active');
                        startAppBtn.disabled = false;
                        this.selectedUserId = parseInt(card.getAttribute('data-user-id'));
                    });
                });
                
                // Auto-select first user if none selected
                if (users.length > 0 && !this.selectedUserId) {
                    document.querySelector('.user-card').click();
                }
            },
            
            // Show new user form
            showNewUserForm() {
                document.getElementById('newUserForm').style.display = 'block';
                document.getElementById('addUserBtn').style.display = 'none';
            },
            
            // Hide new user form
            hideNewUserForm() {
                document.getElementById('newUserForm').style.display = 'none';
                document.getElementById('addUserBtn').style.display = 'inline-flex';
                document.getElementById('userForm').reset();
            },
            
            // Handle user form submission
            handleUserSubmit(e) {
                e.preventDefault();
                
                const user = {
                    id: Date.now(),
                    name: document.getElementById('userName').value,
                    email: document.getElementById('userEmail').value,
                    age: parseInt(document.getElementById('userAge').value),
                    gender: document.getElementById('userGender').value,
                    height: parseFloat(document.getElementById('userHeight').value),
                    weight: parseFloat(document.getElementById('userWeight').value),
                    joined: new Date().toISOString()
                };
                
                this.saveUser(user);
                this.hideNewUserForm();
                this.displayUserSelection();
                
                // Auto-select the new user
                this.selectedUserId = user.id;
                document.querySelector(`[data-user-id="${user.id}"]`).click();
            },
            
            // Start the main application
            startApp() {
                if (!this.selectedUserId) return;
                
                // Set the current user
                localStorage.setItem('fitnessTrackerCurrentUser', this.selectedUserId);
                
                // Hide user selection and show main app
                document.getElementById('user-selection').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                
                // Initialize the main app
                this.initMainApp();
            },
            
            // Initialize the main application
            initMainApp() {
                this.setupMainAppEventListeners();
                this.initializeCharts();
                this.setDefaultDates();
                this.displayUsers();
                this.switchUser(this.getCurrentUserId());
            },
            
            // Setup event listeners for the main app
            setupMainAppEventListeners() {
                // Tab navigation
                document.querySelectorAll('.tab, nav a').forEach(element => {
                    element.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.switchTab(element.getAttribute('data-tab'));
                    });
                });
                
                // Form submissions
                document.getElementById('workoutForm').addEventListener('submit', (e) => this.handleWorkoutSubmit(e));
                document.getElementById('mealForm').addEventListener('submit', (e) => this.handleMealSubmit(e));
                document.getElementById('measurementForm').addEventListener('submit', (e) => this.handleMeasurementSubmit(e));
                document.getElementById('goalForm').addEventListener('submit', (e) => this.handleGoalSubmit(e));
                document.getElementById('userFormMain').addEventListener('submit', (e) => this.handleUserSubmitMain(e));
                document.getElementById('quickWorkoutForm').addEventListener('submit', (e) => this.handleQuickWorkoutSubmit(e));
                
                // Button clicks
                document.getElementById('viewAllActivityBtn').addEventListener('click', () => this.switchTab('workouts'));
                document.getElementById('backToSelectionBtn').addEventListener('click', () => this.backToSelection());
                
                // Modal controls
                document.getElementById('quickWorkoutBtn').addEventListener('click', () => this.openModal('quickWorkoutModal'));
                document.getElementById('switchUserBtn').addEventListener('click', () => this.openModal('switchUserModal'));
                document.getElementById('addMealBtn').addEventListener('click', () => this.switchTab('nutrition'));
                document.querySelectorAll('.close-modal').forEach(btn => {
                    btn.addEventListener('click', (e) => this.closeModal(e.target.closest('.modal')));
                });
                
                // Close modal when clicking outside
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) this.closeModal(modal);
                    });
                });
            },
            
            // Get users from localStorage
            getUsers() {
                return JSON.parse(localStorage.getItem('fitnessTrackerUsers') || '[]');
            },
            
            // Get workouts for a specific user
            getUserWorkouts(userId) {
                const workouts = JSON.parse(localStorage.getItem('fitnessTrackerWorkouts') || '[]');
                return workouts.filter(workout => workout.userId === userId);
            },
            
            // Get goals for a specific user
            getUserGoals(userId) {
                const goals = JSON.parse(localStorage.getItem('fitnessTrackerGoals') || '[]');
                return goals.filter(goal => goal.userId === userId);
            },
            
            // Get measurements for a specific user
            getUserMeasurements(userId) {
                const measurements = JSON.parse(localStorage.getItem('fitnessTrackerMeasurements') || '[]');
                return measurements.filter(measurement => measurement.userId === userId);
            },
            
            // Get nutrition for a specific user
            getUserNutrition(userId) {
                const nutrition = JSON.parse(localStorage.getItem('fitnessTrackerNutrition') || '[]');
                return nutrition.filter(meal => meal.userId === userId);
            },
            
            // Get workout count for a user
            getUserWorkoutCount(userId) {
                return this.getUserWorkouts(userId).length;
            },
            
            // Get goal count for a user
            getUserGoalCount(userId) {
                return this.getUserGoals(userId).length;
            },
            
            // Get a color based on user ID (for avatars)
            getUserColor(userId) {
                const colors = ['#4361ee', '#3a0ca3', '#4cc9f0', '#4ade80', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4'];
                return colors[userId % colors.length];
            },
            
            // Get initials from name
            getInitials(name) {
                return name.split(' ').map(part => part[0]).join('').toUpperCase();
            },
            
            // Save user to localStorage
            saveUser(user) {
                const users = this.getUsers();
                users.push(user);
                localStorage.setItem('fitnessTrackerUsers', JSON.stringify(users));
            },
            
            // Save workout to localStorage
            saveWorkout(workout) {
                const workouts = JSON.parse(localStorage.getItem('fitnessTrackerWorkouts') || '[]');
                workouts.push(workout);
                localStorage.setItem('fitnessTrackerWorkouts', JSON.stringify(workouts));
            },
            
            // Save goal to localStorage
            saveGoal(goal) {
                const goals = JSON.parse(localStorage.getItem('fitnessTrackerGoals') || '[]');
                goals.push(goal);
                localStorage.setItem('fitnessTrackerGoals', JSON.stringify(goals));
            },
            
            // Save measurement to localStorage
            saveMeasurement(measurement) {
                const measurements = JSON.parse(localStorage.getItem('fitnessTrackerMeasurements') || '[]');
                measurements.push(measurement);
                localStorage.setItem('fitnessTrackerMeasurements', JSON.stringify(measurements));
            },
            
            // Save nutrition to localStorage
            saveNutrition(meal) {
                const nutrition = JSON.parse(localStorage.getItem('fitnessTrackerNutrition') || '[]');
                nutrition.push(meal);
                localStorage.setItem('fitnessTrackerNutrition', JSON.stringify(nutrition));
            },
            
            // Switch to a different user
            switchUser(userId) {
                localStorage.setItem('fitnessTrackerCurrentUser', userId);
                this.updateUserInterface();
                this.displayWorkouts();
                this.displayGoals();
                this.displayMeasurements();
                this.displayNutrition();
                this.updateDashboard();
                this.updateCharts();
                this.closeModal(document.getElementById('switchUserModal'));
                this.showNotification(`Switched to ${this.getCurrentUserName()}'s profile`);
            },
            
            // Get current user ID
            getCurrentUserId() {
                return parseInt(localStorage.getItem('fitnessTrackerCurrentUser') || '0');
            },
            
            // Get current user name
            getCurrentUserName() {
                const users = this.getUsers();
                const currentUser = users.find(user => user.id === this.getCurrentUserId());
                return currentUser ? currentUser.name : 'Unknown User';
            },
            
            // Get current user initials
            getCurrentUserInitials() {
                const name = this.getCurrentUserName();
                return this.getInitials(name);
            },
            
            // Update user interface with current user info
            updateUserInterface() {
                document.getElementById('currentUserAvatar').textContent = this.getCurrentUserInitials();
                document.getElementById('currentUserName').textContent = this.getCurrentUserName();
                document.getElementById('activeUserAvatar').textContent = this.getCurrentUserInitials();
                document.getElementById('activeUserName').textContent = this.getCurrentUserName();
                
                // Update avatar colors
                const avatars = document.querySelectorAll('.user-avatar, .user-avatar-small');
                avatars.forEach(avatar => {
                    avatar.style.backgroundColor = this.getUserColor(this.getCurrentUserId());
                });
            },
            
            // Handle workout form submission
            handleWorkoutSubmit(e) {
                e.preventDefault();
                
                const workout = {
                    id: Date.now(),
                    userId: this.getCurrentUserId(),
                    type: document.getElementById('workoutType').value,
                    date: document.getElementById('workoutDate').value,
                    duration: parseInt(document.getElementById('workoutDuration').value),
                    calories: parseInt(document.getElementById('workoutCalories').value),
                    notes: document.getElementById('workoutNotes').value,
                    timestamp: new Date().toISOString()
                };
                
                this.saveWorkout(workout);
                this.displayWorkouts();
                this.updateDashboard();
                this.updateCharts();
                this.showNotification('Workout logged successfully!');
                e.target.reset();
                this.setDefaultDates();
            },
            
            // Handle meal form submission
            handleMealSubmit(e) {
                e.preventDefault();
                
                const meal = {
                    id: Date.now(),
                    userId: this.getCurrentUserId(),
                    name: document.getElementById('mealName').value,
                    type: document.getElementById('mealType').value,
                    calories: parseInt(document.getElementById('mealCalories').value),
                    protein: parseFloat(document.getElementById('mealProtein').value || 0),
                    carbs: parseFloat(document.getElementById('mealCarbs').value || 0),
                    fat: parseFloat(document.getElementById('mealFat').value || 0),
                    date: new Date().toISOString().split('T')[0],
                    timestamp: new Date().toISOString()
                };
                
                this.saveNutrition(meal);
                this.displayNutrition();
                this.showNotification('Meal logged successfully!');
                e.target.reset();
            },
            
            // Handle measurement form submission
            handleMeasurementSubmit(e) {
                e.preventDefault();
                
                const measurement = {
                    id: Date.now(),
                    userId: this.getCurrentUserId(),
                    type: document.getElementById('measurementType').value,
                    value: parseFloat(document.getElementById('measurementValue').value),
                    date: document.getElementById('measurementDate').value,
                    timestamp: new Date().toISOString()
                };
                
                this.saveMeasurement(measurement);
                this.displayMeasurements();
                this.updateCharts();
                this.showNotification('Measurement saved successfully!');
                e.target.reset();
                this.setDefaultDates();
            },
            
            // Handle goal form submission
            handleGoalSubmit(e) {
                e.preventDefault();
                
                const goal = {
                    id: Date.now(),
                    userId: this.getCurrentUserId(),
                    type: document.getElementById('goalType').value,
                    target: document.getElementById('goalTarget').value,
                    deadline: document.getElementById('goalDeadline').value,
                    description: document.getElementById('goalDescription').value,
                    progress: 0,
                    created: new Date().toISOString()
                };
                
                this.saveGoal(goal);
                this.displayGoals();
                this.updateDashboard();
                this.showNotification('New goal set successfully!');
                e.target.reset();
                this.setDefaultDates();
            },
            
            // Handle user form submission in main app
            handleUserSubmitMain(e) {
                e.preventDefault();
                
                const user = {
                    id: Date.now(),
                    name: document.getElementById('userNameMain').value,
                    email: document.getElementById('userEmailMain').value,
                    age: parseInt(document.getElementById('userAgeMain').value),
                    gender: document.getElementById('userGenderMain').value,
                    height: parseFloat(document.getElementById('userHeightMain').value),
                    weight: parseFloat(document.getElementById('userWeightMain').value),
                    joined: new Date().toISOString()
                };
                
                this.saveUser(user);
                this.displayUsers();
                this.showNotification('User added successfully!');
                e.target.reset();
            },
            
            // Handle quick workout form submission
            handleQuickWorkoutSubmit(e) {
                e.preventDefault();
                this.closeModal(document.getElementById('quickWorkoutModal'));
                
                const duration = parseInt(document.getElementById('quickWorkoutDuration').value);
                const type = document.getElementById('quickWorkoutType').value;
                
                // Estimate calories based on workout type and duration
                const calorieEstimates = {
                    walk: 4,
                    run: 10,
                    cycle: 8,
                    yoga: 3
                };
                
                const calories = Math.round(duration * calorieEstimates[type]);
                
                const workout = {
                    id: Date.now(),
                    userId: this.getCurrentUserId(),
                    type: type,
                    date: new Date().toISOString().split('T')[0],
                    duration: duration,
                    calories: calories,
                    notes: 'Quick workout session',
                    timestamp: new Date().toISOString()
                };
                
                this.saveWorkout(workout);
                this.displayWorkouts();
                this.updateDashboard();
                this.updateCharts();
                this.showNotification(`Quick ${type} workout completed! ${calories} calories burned.`);
            },
            
            // Display workouts
            displayWorkouts() {
                const workouts = this.getUserWorkouts(this.getCurrentUserId());
                const workoutHistory = document.getElementById('workoutHistory');
                const recentWorkouts = document.getElementById('recentWorkouts');
                
                if (workouts.length === 0) {
                    workoutHistory.innerHTML = '<div class="empty-state"><i class="fas fa-running"></i><p>No workouts logged yet. Add your first workout!</p></div>';
                    recentWorkouts.innerHTML = '<p>No recent workouts.</p>';
                    return;
                }
                
                // Sort by date (newest first)
                workouts.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Display in workout history
                workoutHistory.innerHTML = workouts.map(workout => `
                    <div class="workout-item">
                        <div class="workout-info">
                            <h4>${this.capitalizeFirst(workout.type)} Workout</h4>
                            <div class="workout-meta">
                                <span><i class="fas fa-clock"></i> ${workout.duration} min</span>
                                <span><i class="fas fa-burn"></i> ${workout.calories} cal</span>
                                <span><i class="fas fa-calendar"></i> ${new Date(workout.date).toLocaleDateString()}</span>
                            </div>
                            ${workout.notes ? `<p>${workout.notes}</p>` : ''}
                        </div>
                        <div class="workout-actions">
                            <button onclick="MultiUserFitnessTracker.deleteWorkout(${workout.id})"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `).join('');
                
                // Display recent workouts (last 3)
                const recent = workouts.slice(0, 3);
                recentWorkouts.innerHTML = recent.map(workout => `
                    <div class="workout-item">
                        <div class="workout-info">
                            <h4>${this.capitalizeFirst(workout.type)} Workout</h4>
                            <div class="workout-meta">
                                <span><i class="fas fa-clock"></i> ${workout.duration} min</span>
                                <span><i class="fas fa-burn"></i> ${workout.calories} cal</span>
                                <span><i class="fas fa-calendar"></i> ${new Date(workout.date).toLocaleDateString()}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            },
            
            // Display goals
            displayGoals() {
                const goals = this.getUserGoals(this.getCurrentUserId());
                const goalsList = document.getElementById('goalsList');
                const goalProgressList = document.getElementById('goalProgressList');
                
                if (goals.length === 0) {
                    goalsList.innerHTML = '<div class="empty-state"><i class="fas fa-bullseye"></i><p>No goals set yet. Create your first goal!</p></div>';
                    goalProgressList.innerHTML = '<p>No active goals.</p>';
                    return;
                }
                
                // Calculate progress for goals (simplified for demo)
                goals.forEach(goal => {
                    if (goal.progress === 0) {
                        // Simple progress calculation based on time
                        const created = new Date(goal.created);
                        const deadline = new Date(goal.deadline);
                        const now = new Date();
                        
                        if (now >= deadline) {
                            goal.progress = 100;
                        } else {
                            const totalTime = deadline - created;
                            const elapsedTime = now - created;
                            goal.progress = Math.min(Math.round((elapsedTime / totalTime) * 100), 90);
                        }
                    }
                });
                
                // Display in goals tab
                goalsList.innerHTML = goals.map(goal => `
                    <div class="goal-item">
                        <div class="goal-header">
                            <span class="goal-title">${this.capitalizeFirst(goal.type)}: ${goal.target}</span>
                            <span class="goal-deadline">${new Date(goal.deadline).toLocaleDateString()}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: ${goal.progress}%"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span>${goal.progress}% complete</span>
                            <span>${100 - goal.progress}% to go</span>
                        </div>
                        ${goal.description ? `<p style="margin-top: 10px;">${goal.description}</p>` : ''}
                        <div class="workout-actions" style="margin-top: 10px;">
                            <button onclick="MultiUserFitnessTracker.deleteGoal(${goal.id})"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `).join('');
                
                // Display in sidebar (first 2 goals)
                const sidebarGoals = goals.slice(0, 2);
                goalProgressList.innerHTML = sidebarGoals.map(goal => `
                    <div class="goal-item">
                        <div class="goal-header">
                            <span class="goal-title">${this.capitalizeFirst(goal.type)}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: ${goal.progress}%"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                            <span>${goal.progress}%</span>
                        </div>
                    </div>
                `).join('');
            },
            
            // Display measurements
            displayMeasurements() {
                const measurements = this.getUserMeasurements(this.getCurrentUserId());
                const measurementHistory = document.getElementById('measurementHistory');
                
                if (measurements.length === 0) {
                    measurementHistory.innerHTML = '<div class="empty-state"><i class="fas fa-ruler"></i><p>No measurements recorded yet.</p></div>';
                    return;
                }
                
                // Group measurements by type
                const measurementsByType = {};
                measurements.forEach(measurement => {
                    if (!measurementsByType[measurement.type]) {
                        measurementsByType[measurement.type] = [];
                    }
                    measurementsByType[measurement.type].push(measurement);
                });
                
                // Display measurements
                measurementHistory.innerHTML = Object.keys(measurementsByType).map(type => `
                    <div class="measurement-item">
                        <div class="measurement-header">
                            <strong>${this.capitalizeFirst(type)}</strong>
                        </div>
                        ${measurementsByType[type].map(measurement => `
                            <div style="display: flex; justify-content: space-between;">
                                <span>${new Date(measurement.date).toLocaleDateString()}</span>
                                <span>${measurement.value} ${type === 'weight' ? 'kg' : 'cm'}</span>
                            </div>
                        `).join('')}
                    </div>
                `).join('');
            },
            
            // Display nutrition
            displayNutrition() {
                const nutrition = this.getUserNutrition(this.getCurrentUserId());
                const today = new Date().toISOString().split('T')[0];
                const todayMeals = nutrition.filter(meal => meal.date === today);
                
                // Update nutrition summary
                let totalCalories = 0;
                let totalProtein = 0;
                let totalCarbs = 0;
                let totalFat = 0;
                
                todayMeals.forEach(meal => {
                    totalCalories += meal.calories;
                    totalProtein += meal.protein;
                    totalCarbs += meal.carbs;
                    totalFat += meal.fat;
                });
                
                document.getElementById('totalCalories').textContent = totalCalories;
                document.getElementById('totalProtein').textContent = `${totalProtein}g`;
                document.getElementById('totalCarbs').textContent = `${totalCarbs}g`;
                document.getElementById('totalFat').textContent = `${totalFat}g`;
                
                // Update nutrition chart
                if (this.nutritionChart) {
                    this.nutritionChart.data.datasets[0].data = [totalProtein, totalCarbs, totalFat];
                    this.nutritionChart.update();
                }
            },
            
            // Display users
            displayUsers() {
                const users = this.getUsers();
                const usersList = document.getElementById('usersList');
                const switchUserList = document.getElementById('switchUserList');
                
                if (users.length === 0) {
                    usersList.innerHTML = '<p>No users added yet.</p>';
                    switchUserList.innerHTML = '<p>No users available.</p>';
                    return;
                }
                
                // Display in users tab
                usersList.innerHTML = users.map(user => `
                    <div class="user-item" data-user-id="${user.id}">
                        <div class="user-item-info">
                            <div class="user-avatar-small" style="background: ${this.getUserColor(user.id)};">${this.getInitials(user.name)}</div>
                            <div>
                                <div>${user.name}</div>
                                <div style="font-size: 0.8rem; color: var(--gray);">${user.email}</div>
                            </div>
                        </div>
                        <div class="workout-actions">
                            <button onclick="MultiUserFitnessTracker.switchUser(${user.id})"><i class="fas fa-sign-in-alt"></i></button>
                            <button onclick="MultiUserFitnessTracker.deleteUser(${user.id})"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `).join('');
                
                // Display in switch user modal
                switchUserList.innerHTML = users.map(user => `
                    <div class="user-item ${user.id === this.getCurrentUserId() ? 'active' : ''}" data-user-id="${user.id}" onclick="MultiUserFitnessTracker.switchUser(${user.id})">
                        <div class="user-item-info">
                            <div class="user-avatar-small" style="background: ${this.getUserColor(user.id)};">${this.getInitials(user.name)}</div>
                            <div>
                                <div>${user.name}</div>
                                <div style="font-size: 0.8rem; color: var(--gray);">${user.email}</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            },
            
            // Update dashboard with current user data
            updateDashboard() {
                const workouts = this.getUserWorkouts(this.getCurrentUserId());
                const today = new Date().toISOString().split('T')[0];
                const todayWorkouts = workouts.filter(workout => workout.date === today);
                
                let totalCalories = 0;
                let totalMinutes = 0;
                
                todayWorkouts.forEach(workout => {
                    totalCalories += workout.calories;
                    totalMinutes += workout.duration;
                });
                
                document.getElementById('todayCalories').textContent = totalCalories;
                document.getElementById('todayMinutes').textContent = totalMinutes;
                document.getElementById('todayWorkouts').textContent = todayWorkouts.length;
                
                // Simulate steps based on workouts
                const steps = todayWorkouts.reduce((total, workout) => {
                    return total + (workout.duration * 100); // Approximate steps based on workout duration
                }, 0);
                
                document.getElementById('todaySteps').textContent = steps.toLocaleString();
                
                // Update achievements
                this.updateAchievements();
                
                // Update health stats (simulated)
                document.getElementById('restingHR').textContent = Math.floor(Math.random() * 20) + 60;
                document.getElementById('avgSleep').textContent = (Math.random() * 2 + 6).toFixed(1);
                document.getElementById('avgCalories').textContent = Math.floor(Math.random() * 500) + 1800;
            },
            
            // Update achievements
            updateAchievements() {
                const workouts = this.getUserWorkouts(this.getCurrentUserId());
                const goals = this.getUserGoals(this.getCurrentUserId());
                const achievementsList = document.getElementById('achievementsList');
                
                const achievements = [];
                
                // Check for achievements
                if (workouts.length >= 1) {
                    achievements.push('<div class="achievement-badge"><i class="fas fa-medal" style="color: #cd7f32;"></i> First Workout</div>');
                }
                
                if (workouts.length >= 5) {
                    achievements.push('<div class="achievement-badge"><i class="fas fa-medal" style="color: silver;"></i> 5 Workouts</div>');
                }
                
                if (workouts.length >= 10) {
                    achievements.push('<div class="achievement-badge"><i class="fas fa-medal" style="color: gold;"></i> 10 Workouts</div>');
                }
                
                if (goals.length >= 1) {
                    achievements.push('<div class="achievement-badge"><i class="fas fa-bullseye"></i> Goal Setter</div>');
                }
                
                // Check for streak (simplified)
                const recentWorkouts = workouts.slice(0, 3);
                if (recentWorkouts.length >= 3) {
                    const dates = recentWorkouts.map(w => new Date(w.date));
                    const today = new Date();
                    const yesterday = new Date(today);
                    yesterday.setDate(yesterday.getDate() - 1);
                    
                    if (dates.some(d => d.toDateString() === today.toDateString()) ||
                        dates.some(d => d.toDateString() === yesterday.toDateString())) {
                        achievements.push('<div class="achievement-badge"><i class="fas fa-fire"></i> Active Streak</div>');
                    }
                }
                
                achievementsList.innerHTML = achievements.length > 0 ? achievements.join('') : '<div class="achievement-badge"><i class="fas fa-user"></i> New User</div>';
            },
            
            // Initialize charts
            initializeCharts() {
                // Activity Chart
                const activityCtx = document.getElementById('activityChart').getContext('2d');
                this.activityChart = new Chart(activityCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Workout Minutes',
                            data: [0, 0, 0, 0, 0, 0, 0],
                            backgroundColor: 'rgba(67, 97, 238, 0.7)',
                            borderColor: 'rgba(67, 97, 238, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Minutes'
                                }
                            }
                        }
                    }
                });
                
                // Weight Chart
                const weightCtx = document.getElementById('weightChart').getContext('2d');
                this.weightChart = new Chart(weightCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Weight (kg)',
                            data: [],
                            backgroundColor: 'rgba(76, 201, 240, 0.2)',
                            borderColor: 'rgba(76, 201, 240, 1)',
                            borderWidth: 2,
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: 'Weight (kg)'
                                }
                            }
                        }
                    }
                });
                
                // Nutrition Chart
                const nutritionCtx = document.getElementById('nutritionChart').getContext('2d');
                this.nutritionChart = new Chart(nutritionCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Protein', 'Carbs', 'Fat'],
                        datasets: [{
                            data: [0, 0, 0],
                            backgroundColor: [
                                'rgba(74, 222, 128, 0.7)',
                                'rgba(67, 97, 238, 0.7)',
                                'rgba(245, 158, 11, 0.7)'
                            ],
                            borderColor: [
                                'rgba(74, 222, 128, 1)',
                                'rgba(67, 97, 238, 1)',
                                'rgba(245, 158, 11, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
                
                // Measurements Chart
                const measurementsCtx = document.getElementById('measurementsChart').getContext('2d');
                this.measurementsChart = new Chart(measurementsCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false
                            }
                        }
                    }
                });
            },
            
            // Update charts with current user data
            updateCharts() {
                const workouts = this.getUserWorkouts(this.getCurrentUserId());
                const measurements = this.getUserMeasurements(this.getCurrentUserId());
                
                // Update activity chart (simplified - last 7 days)
                if (this.activityChart) {
                    const last7Days = this.getLast7Days();
                    const dailyMinutes = last7Days.map(day => {
                        const dayWorkouts = workouts.filter(w => w.date === day);
                        return dayWorkouts.reduce((total, w) => total + w.duration, 0);
                    });
                    
                    this.activityChart.data.datasets[0].data = dailyMinutes;
                    this.activityChart.update();
                }
                
                // Update weight chart
                if (this.weightChart) {
                    const weightMeasurements = measurements.filter(m => m.type === 'weight')
                        .sort((a, b) => new Date(a.date) - new Date(b.date));
                    
                    this.weightChart.data.labels = weightMeasurements.map(m => 
                        new Date(m.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })
                    );
                    this.weightChart.data.datasets[0].data = weightMeasurements.map(m => m.value);
                    this.weightChart.update();
                }
                
                // Update measurements chart
                if (this.measurementsChart) {
                    const measurementTypes = ['chest', 'waist', 'biceps'];
                    const datasets = [];
                    
                    measurementTypes.forEach(type => {
                        const typeMeasurements = measurements.filter(m => m.type === type)
                            .sort((a, b) => new Date(a.date) - new Date(b.date));
                        
                        if (typeMeasurements.length > 0) {
                            const colors = {
                                chest: 'rgba(67, 97, 238, 1)',
                                waist: 'rgba(76, 201, 240, 1)',
                                biceps: 'rgba(74, 222, 128, 1)'
                            };
                            
                            datasets.push({
                                label: this.capitalizeFirst(type) + ' (cm)',
                                data: typeMeasurements.map(m => m.value),
                                borderColor: colors[type],
                                backgroundColor: colors[type] + '20',
                                borderWidth: 2,
                                tension: 0.3
                            });
                        }
                    });
                    
                    if (datasets.length > 0) {
                        // Use dates from the first dataset
                        const firstTypeMeasurements = measurements.filter(m => m.type === measurementTypes[0])
                            .sort((a, b) => new Date(a.date) - new Date(b.date));
                        
                        this.measurementsChart.data.labels = firstTypeMeasurements.map(m => 
                            new Date(m.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })
                        );
                        this.measurementsChart.data.datasets = datasets;
                        this.measurementsChart.update();
                    }
                }
            },
            
            // Get last 7 days as YYYY-MM-DD
            getLast7Days() {
                const days = [];
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    days.push(date.toISOString().split('T')[0]);
                }
                return days;
            },
            
            // Switch between tabs
            switchTab(tabId) {
                // Update active tab
                document.querySelectorAll('.tab, nav a').forEach(el => {
                    el.classList.remove('active');
                });
                document.querySelectorAll(`[data-tab="${tabId}"]`).forEach(el => {
                    el.classList.add('active');
                });
                
                // Show corresponding content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tabId).classList.add('active');
                
                // Update charts when switching to certain tabs
                if (tabId === 'dashboard' || tabId === 'progress') {
                    this.updateCharts();
                }
            },
            
            // Delete workout
            deleteWorkout(id) {
                if (confirm('Are you sure you want to delete this workout?')) {
                    const workouts = JSON.parse(localStorage.getItem('fitnessTrackerWorkouts') || '[]');
                    const updatedWorkouts = workouts.filter(workout => workout.id !== id);
                    localStorage.setItem('fitnessTrackerWorkouts', JSON.stringify(updatedWorkouts));
                    this.displayWorkouts();
                    this.updateDashboard();
                    this.updateCharts();
                    this.showNotification('Workout deleted successfully!');
                }
            },
            
            // Delete goal
            deleteGoal(id) {
                if (confirm('Are you sure you want to delete this goal?')) {
                    const goals = JSON.parse(localStorage.getItem('fitnessTrackerGoals') || '[]');
                    const updatedGoals = goals.filter(goal => goal.id !== id);
                    localStorage.setItem('fitnessTrackerGoals', JSON.stringify(updatedGoals));
                    this.displayGoals();
                    this.showNotification('Goal deleted successfully!');
                }
            },
            
            // Delete user
            deleteUser(id) {
                if (confirm('Are you sure you want to delete this user? All their data will be lost.')) {
                    const users = this.getUsers();
                    const updatedUsers = users.filter(user => user.id !== id);
                    localStorage.setItem('fitnessTrackerUsers', JSON.stringify(updatedUsers));
                    
                    // If deleting the current user, switch to another user
                    if (id === this.getCurrentUserId()) {
                        const remainingUsers = updatedUsers.length > 0 ? updatedUsers[0] : null;
                        if (remainingUsers) {
                            this.switchUser(remainingUsers.id);
                        } else {
                            // No users left, go back to selection
                            this.backToSelection();
                        }
                    }
                    
                    this.displayUsers();
                    this.showNotification('User deleted successfully!');
                }
            },
            
            // Go back to user selection screen
            backToSelection() {
                document.getElementById('main-app').style.display = 'none';
                document.getElementById('user-selection').style.display = 'block';
                this.displayUserSelection();
            },
            
            // Open modal
            openModal(modalId) {
                document.getElementById(modalId).style.display = 'flex';
            },
            
            // Close modal
            closeModal(modal) {
                modal.style.display = 'none';
            },
            
            // Show notification
            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                const notificationText = document.getElementById('notificationText');
                
                // Set notification color based on type
                if (type === 'success') {
                    notification.style.background = 'var(--success)';
                } else if (type === 'info') {
                    notification.style.background = 'var(--primary)';
                } else if (type === 'warning') {
                    notification.style.background = 'var(--warning)';
                } else if (type === 'error') {
                    notification.style.background = 'var(--danger)';
                }
                
                notificationText.textContent = message;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            },
            
            // Set default dates in forms to today
            setDefaultDates() {
                const today = new Date().toISOString().split('T')[0];
                if (document.getElementById('workoutDate')) {
                    document.getElementById('workoutDate').value = today;
                }
                if (document.getElementById('measurementDate')) {
                    document.getElementById('measurementDate').value = today;
                }
                if (document.getElementById('goalDeadline')) {
                    // Default to 30 days from now
                    const futureDate = new Date();
                    futureDate.setDate(futureDate.getDate() + 30);
                    document.getElementById('goalDeadline').value = futureDate.toISOString().split('T')[0];
                }
            },
            
            // Capitalize first letter of a string
            capitalizeFirst(string) {
                return string.charAt(0).toUpperCase() + string.slice(1);
            }
        };

        // Initialize the app when the DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            MultiUserFitnessTracker.init();
        });
    </script>
</body>
</html>